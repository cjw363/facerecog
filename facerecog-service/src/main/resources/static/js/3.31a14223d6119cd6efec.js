webpackJsonp([3,11,27],{"7tcK":function(e,t){},"G+yG":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("fNJ+"),s=a("K+8q"),r={name:"PersonDetail",data:function(){return{activeName:"first",person:{}}},components:{PersonInfo:n.default,PersonGrantDevice:s.default},methods:{get:function(){var e=this;this.$post("/person/detail",{person_id:this.$route.query.person_id}).then(function(t){e.person=t.data})}},created:function(){this.get()},watch:{$route:"get"}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-breadcrumb",{staticStyle:{"margin-bottom":"15px"},attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("人员管理")]),e._v(" "),a("el-breadcrumb-item",[e._v("人员详情")]),e._v(" "),a("el-breadcrumb-item",[e._v(e._s(e.person.person_name))])],1),e._v(" "),[a("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[a("PersonInfo",{attrs:{person:e.person}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"授权设备",name:"second"}},[a("PersonGrantDevice",{attrs:{person:e.person}})],1)],1)]],2)},staticRenderFns:[]};var i=a("VU/8")(r,o,!1,function(e){a("7tcK")},"data-v-8899b0e4",null);t.default=i.exports},"K+8q":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("rn3r"),s=a("Ktqm"),r={name:"PersonGrantDevice",components:{DialogAddDevice:n.default,DialogChangeGrant:s.default},props:{person:{}},data:function(){return{tableData:[],currentPage:1,pageSizes:[5,10,20],pageSize:10,tableTotal:0,selectGroupModel:"",keyword:"",group_id:""}},methods:{get:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{pageNum:this.currentPage,pageSize:this.pageSize,person_id:this.person.person_id,group_id:this.group_id,keyword:this.keyword};this.$get("/person/access_device_list",t).then(function(t){e.tableData=t.data.list,e.tableTotal=t.data.total})},handleChange:function(){this.get()},changeSelectGroup:function(e){this.group_id=e,this.get({group_id:e,pageNum:1,pageSize:this.pageSize,person_id:this.person.person_id,keyword:this.keyword})},searchGrantDeviceList:function(){this.get({pageNum:1,pageSize:this.pageSize,keyword:this.keyword,group_id:this.group_id,person_id:this.person.person_id})},openDialogAddDevice:function(){this.$refs.refDialogAddDevice.openDialogAddDevice()},openDialogUpdateGrant:function(e){this.$refs.refDialogChangeGrant.initData(e),this.$refs.refDialogChangeGrant.changeDialogChangeGrantVs()},banGrantDevice:function(e){var t=this;this.$post("/grant/ban",{device_ids:e.row.device_id,person_ids:this.person.person_id}).then(function(a){t.$message.success(a.message),t.$utils.arrayRemoveObj(t.tableData,e.row),t.tableTotal--})},changeTableData:function(e){this.tableData.find(function(t){e.grant_id===t.grant_id&&(t.pass_number=e.pass_number,t.pass_start_time=e.pass_start_time,t.pass_end_time=e.pass_end_time)})}},created:function(){this.group_id="",this.selectGroupModel="",this.keyword="",this.get()},watch:{person:function(){this.group_id="",this.selectGroupModel="",this.keyword="",this.get()}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"box"},[a("el-form",[a("el-form-item",[a("el-row",[a("div",{staticStyle:{float:"left"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择部门",size:"small"},on:{change:e.changeSelectGroup},model:{value:e.selectGroupModel,callback:function(t){e.selectGroupModel=t},expression:"selectGroupModel"}},e._l(e.person.group_list,function(e){return a("el-option",{key:e.group_id,attrs:{label:e.group_name,value:e.group_id}})}),1),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.openDialogAddDevice}},[e._v("添加")])],1),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",placeholder:"请输入搜索内容"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.searchGrantDeviceList}},[e._v("搜索")])],1)])],1)],1),e._v(" "),[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[a("el-table-column",{attrs:{prop:"grant_id",label:"授权ID","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"device_id",label:"设备ID","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"device_name",label:"设备名","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sync_status",label:"同步状态","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.sync_status?a("span",[e._v("未同步")]):e._e(),e._v(" "),1===t.row.sync_status?a("span",[e._v("同步成功")]):e._e(),e._v(" "),2===t.row.sync_status?a("span",[e._v("下载失败")]):e._e(),e._v(" "),3===t.row.sync_status?a("span",[e._v("图片失败")]):e._e(),e._v(" "),4===t.row.sync_status?a("span",[e._v("特征值失败")]):e._e(),e._v(" "),5===t.row.sync_status?a("span",[e._v("其他失败")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pass_number",label:"通行次数","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[9999999999===t.row.pass_number?a("span",[e._v("无限次数")]):a("span",[e._v(e._s(t.row.pass_number))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pass_start_time",label:"通行时段","min-width":"30%"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.pass_start_time.indexOf("2286")||0===t.row.pass_end_time.indexOf("2286")?a("span",[e._v("无限时段")]):e._e(),e._v(" "),0!==t.row.pass_start_time.indexOf("2286")?a("span",[e._v(e._s(e._f("formatDate")(t.row.pass_start_time))+" - "+e._s(e._f("formatDate")(t.row.pass_end_time)))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(a){return e.openDialogUpdateGrant(t.row)}}},[e._v(" 修改")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return e.banGrantDevice(t)}}},[e._v("禁止")])]}}])})],1)],e._v(" "),[a("div",{staticClass:"block"},[a("el-pagination",{ref:"pagination",attrs:{"current-page":e.currentPage,"page-size":e.pageSize,"page-sizes":e.pageSizes,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:e.tableTotal},on:{"size-change":e.handleChange,"current-change":e.handleChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t}}})],1)],e._v(" "),a("DialogAddDevice",{ref:"refDialogAddDevice",attrs:{person:e.person}}),e._v(" "),a("DialogChangeGrant",{ref:"refDialogChangeGrant",attrs:{person:e.person}})],2)},staticRenderFns:[]};var i=a("VU/8")(r,o,!1,function(e){a("vYYq")},"data-v-aaa28e5a",null);t.default=i.exports},ZLg6:function(e,t){},"fNJ+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("woOf"),s=a.n(n),r=a("yyct"),o=a("4RJ8"),i=a.n(o),l=(a("5Qkr"),{name:"PersonInfo",inject:["reloadPerson"],props:{person:{type:Object,default:function(){return{}},person_id:"",add_time:"",person_name:"",emp_number:"",base_image:""}},data:function(){return{personModel:"",rules:{person_name:[{required:!0,message:"请输入姓名",trigger:"blur"}]},action:"/person/update_info",imageUrl:"",file:"",replace:!1,uploadBlob:"",visible:!1}},methods:{deletePerson:function(){var e=this;r.a.confirm("确定删除该人员？").then(function(){e.$post("/person/delete",{person_id:e.person.person_id}).then(function(t){r.a.success(t.message),e.reloadPerson(),e.$router.push("/person/person_tbl")})})},myUpload:function(){var e=this,t=this.$refs.perBaseInfoForm.model,a=this.uploadBlob;r.a.showLoading("上传中");var n=new FormData;n.append("person_id",this.person.person_id),n.append("person_name",t.person_name),n.append("emp_number",t.emp_number),n.append("file",a),this.$axios.post("/person/update_img_info",n,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){var t=(e.loaded/e.total*100|0)+"%";console.log(t)}}).then(function(t){r.a.closeLoading(),r.a.alert(t.data.message),e.personList.find(function(t){return t.person_id===e.person.person_id}).person_name=e.personModel.person_name}).catch(function(e){r.a.closeLoading()})},onChange:function(e,t){this.$refs.upload.clearFiles();var a=-1!==e.raw.type.indexOf("image"),n=e.raw.size/1024/1024<3;a?n?(this.file=e,this.visible=!0):this.$message.error("图片不能超过3M"):this.$message.error("不支持该格式")},beforeUpload:function(e){var t=this.uploadBlob.size/1024<65;return t||this.$message.error("图片过大"),t},onClickUpload:function(){var e=this;this.$refs.perBaseInfoForm.validate(function(t){if(t)if(e.$refs.upload.uploadFiles.length<1){var a=e.$refs.perBaseInfoForm.model;e.$post("/person/update_info",{person_id:e.person.person_id,person_name:a.person_name,emp_number:a.emp_number}).then(function(t){e.$message.success(t.message),e.personList.find(function(t){return t.person_id===e.person.person_id}).person_name=e.personModel.person_name})}else e.$refs.upload.uploadFiles.length>1?e.$message.error("请选择图片"):e.$refs.upload.submit()})},onClickCropper:function(){var e=this.cropper.getCroppedCanvas({width:480,height:480,minWidth:240,minHeight:240,maxWidth:480,maxHeight:480,fillColor:"#000",imageSmoothingEnabled:!1,imageSmoothingQuality:"high"}),t=this.file.raw.size/1024,a=void 0;a=t>2048?.6:t>1024&&t<2048?.7:t>65&&t<1024?.75:.9;var n=e.toDataURL("image/jpeg",a);this.$refs.upload.uploadFiles[0]=this.file,this.uploadBlob=this.$utils.dataURLtoBlob(n),this.visible=!1,this.imageUrl=n},opened:function(){if(this.replace)this.cropper.replace(URL.createObjectURL(this.file.raw));else{var e=document.getElementsByClassName("cropper-container")[0].children[0];e.src=URL.createObjectURL(this.file.raw),this.cropper=new i.a(e,{aspectRatio:1,viewMode:0,preview:".cropper-preview"}),this.replace=!0}},closed:function(){this.visible=!1,this.file=""}},watch:{person:function(e,t){this.personModel=s()({},this.person),this.imageUrl="data:image/jpeg;base64,"+this.person.base_image}},computed:{personList:function(){return this.$store.getters["person/getPersonList"]}}}),p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"perBaseInfoForm",attrs:{"label-width":"150px",rules:e.rules},model:{value:e.personModel,callback:function(t){e.personModel=t},expression:"personModel"}},[a("el-form-item",{attrs:{label:"人员ID"}},[a("span",[e._v(e._s(e.person.person_id))])]),e._v(" "),a("el-form-item",{attrs:{label:"注册时间"}},[a("span",[e._v(e._s(e._f("formatDate")(e.person.add_time)))])]),e._v(" "),a("el-form-item",{attrs:{label:"姓名",prop:"person_name"}},[a("el-input",{attrs:{value:e.person.person_name,type:"text",autocomplete:"off",size:"small"},model:{value:e.personModel.person_name,callback:function(t){e.$set(e.personModel,"person_name",t)},expression:"personModel.person_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"工号"}},[a("el-input",{attrs:{value:e.person.emp_number,type:"text",autocomplete:"off",size:"small"},model:{value:e.personModel.emp_number,callback:function(t){e.$set(e.personModel,"emp_number",t)},expression:"personModel.emp_number"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"底库图片"}},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:e.action,"show-file-list":!0,"http-request":e.myUpload,"auto-upload":!1,"on-change":e.onChange,"before-upload":e.beforeUpload}},[e.imageUrl?a("img",{staticClass:"image avatar",attrs:{src:e.imageUrl}}):e._e()])],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onClickUpload()}}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.deletePerson()}}},[e._v("删除")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"请将头像位于框中",visible:e.visible,width:"650px"},on:{"update:visible":function(t){e.visible=t},opened:e.opened,closed:e.closed}},[a("el-row",[a("el-col",{attrs:{span:16}},[a("div",{staticClass:"cropper-container"},[a("img")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"cropper-preview"})])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onClickCropper}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(l,p,!1,function(e){a("ZLg6")},"data-v-1d18f43e",null);t.default=c.exports},vYYq:function(e,t){}});