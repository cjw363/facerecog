webpackJsonp([11],{"K+8q":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("rn3r"),s=a("Ktqm"),i={name:"PersonGrantDevice",components:{DialogAddDevice:n.default,DialogChangeGrant:s.default},props:{person:{}},data:function(){return{tableData:[],currentPage:1,pageSizes:[5,10,20],pageSize:10,tableTotal:0,selectGroupModel:"",keyword:"",group_id:""}},methods:{get:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{pageNum:this.currentPage,pageSize:this.pageSize,person_id:this.person.person_id,group_id:this.group_id,keyword:this.keyword};this.$get("/person/access_device_list",t).then(function(t){e.tableData=t.data.list,e.tableTotal=t.data.total})},handleChange:function(){this.get()},changeSelectGroup:function(e){this.group_id=e,this.get({group_id:e,pageNum:1,pageSize:this.pageSize,person_id:this.person.person_id,keyword:this.keyword})},searchGrantDeviceList:function(){this.get({pageNum:1,pageSize:this.pageSize,keyword:this.keyword,group_id:this.group_id,person_id:this.person.person_id})},openDialogAddDevice:function(){this.$refs.refDialogAddDevice.openDialogAddDevice()},openDialogUpdateGrant:function(e){this.$refs.refDialogChangeGrant.initData(e),this.$refs.refDialogChangeGrant.changeDialogChangeGrantVs()},banGrantDevice:function(e){var t=this;this.$post("/grant/ban",{device_ids:e.row.device_id,person_ids:this.person.person_id}).then(function(a){t.$message.success(a.message),t.$utils.arrayRemoveObj(t.tableData,e.row),t.tableTotal--})},changeTableData:function(e){this.tableData.find(function(t){e.grant_id===t.grant_id&&(t.pass_number=e.pass_number,t.pass_start_time=e.pass_start_time,t.pass_end_time=e.pass_end_time)})}},created:function(){this.group_id="",this.selectGroupModel="",this.keyword="",this.get()},watch:{person:function(){this.group_id="",this.selectGroupModel="",this.keyword="",this.get()}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"box"},[a("el-form",[a("el-form-item",[a("el-row",[a("div",{staticStyle:{float:"left"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择部门",size:"small"},on:{change:e.changeSelectGroup},model:{value:e.selectGroupModel,callback:function(t){e.selectGroupModel=t},expression:"selectGroupModel"}},e._l(e.person.group_list,function(e){return a("el-option",{key:e.group_id,attrs:{label:e.group_name,value:e.group_id}})}),1),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.openDialogAddDevice}},[e._v("添加")])],1),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",placeholder:"请输入搜索内容"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.searchGrantDeviceList}},[e._v("搜索")])],1)])],1)],1),e._v(" "),[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[a("el-table-column",{attrs:{prop:"grant_id",label:"授权ID","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"device_id",label:"设备ID","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"device_name",label:"设备名","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sync_status",label:"同步状态","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.sync_status?a("span",[e._v("未同步")]):e._e(),e._v(" "),1===t.row.sync_status?a("span",[e._v("同步成功")]):e._e(),e._v(" "),2===t.row.sync_status?a("span",[e._v("下载失败")]):e._e(),e._v(" "),3===t.row.sync_status?a("span",[e._v("图片失败")]):e._e(),e._v(" "),4===t.row.sync_status?a("span",[e._v("特征值失败")]):e._e(),e._v(" "),5===t.row.sync_status?a("span",[e._v("其他失败")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pass_number",label:"通行次数","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[9999999999===t.row.pass_number?a("span",[e._v("无限次数")]):a("span",[e._v(e._s(t.row.pass_number))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pass_start_time",label:"通行时段","min-width":"30%"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.pass_start_time.indexOf("2286")||0===t.row.pass_end_time.indexOf("2286")?a("span",[e._v("无限时段")]):e._e(),e._v(" "),0!==t.row.pass_start_time.indexOf("2286")?a("span",[e._v(e._s(e._f("formatDate")(t.row.pass_start_time))+" - "+e._s(e._f("formatDate")(t.row.pass_end_time)))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(a){return e.openDialogUpdateGrant(t.row)}}},[e._v(" 修改")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return e.banGrantDevice(t)}}},[e._v("禁止")])]}}])})],1)],e._v(" "),[a("div",{staticClass:"block"},[a("el-pagination",{ref:"pagination",attrs:{"current-page":e.currentPage,"page-size":e.pageSize,"page-sizes":e.pageSizes,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:e.tableTotal},on:{"size-change":e.handleChange,"current-change":e.handleChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t}}})],1)],e._v(" "),a("DialogAddDevice",{ref:"refDialogAddDevice",attrs:{person:e.person}}),e._v(" "),a("DialogChangeGrant",{ref:"refDialogChangeGrant",attrs:{person:e.person}})],2)},staticRenderFns:[]};var o=a("VU/8")(i,r,!1,function(e){a("vYYq")},"data-v-aaa28e5a",null);t.default=o.exports},vYYq:function(e,t){}});