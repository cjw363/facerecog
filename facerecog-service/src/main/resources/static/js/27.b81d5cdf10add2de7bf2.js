webpackJsonp([27],{ZLg6:function(e,o){},"fNJ+":function(e,o,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var t=s("woOf"),r=s.n(t),n=s("yyct"),a=s("4RJ8"),i=s.n(a),l=(s("5Qkr"),{name:"PersonInfo",inject:["reloadPerson"],props:{person:{type:Object,default:function(){return{}},person_id:"",add_time:"",person_name:"",emp_number:"",base_image:""}},data:function(){return{personModel:"",rules:{person_name:[{required:!0,message:"请输入姓名",trigger:"blur"}]},action:"/person/update_info",imageUrl:"",file:"",replace:!1,uploadBlob:"",visible:!1}},methods:{deletePerson:function(){var e=this;n.a.confirm("确定删除该人员？").then(function(){e.$post("/person/delete",{person_id:e.person.person_id}).then(function(o){n.a.success(o.message),e.reloadPerson(),e.$router.push("/person/person_tbl")})})},myUpload:function(){var e=this,o=this.$refs.perBaseInfoForm.model,s=this.uploadBlob;n.a.showLoading("上传中");var t=new FormData;t.append("person_id",this.person.person_id),t.append("person_name",o.person_name),t.append("emp_number",o.emp_number),t.append("file",s),this.$axios.post("/person/update_img_info",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){var o=(e.loaded/e.total*100|0)+"%";console.log(o)}}).then(function(o){n.a.closeLoading(),n.a.alert(o.data.message),e.personList.find(function(o){return o.person_id===e.person.person_id}).person_name=e.personModel.person_name}).catch(function(e){n.a.closeLoading()})},onChange:function(e,o){this.$refs.upload.clearFiles();var s=-1!==e.raw.type.indexOf("image"),t=e.raw.size/1024/1024<3;s?t?(this.file=e,this.visible=!0):this.$message.error("图片不能超过3M"):this.$message.error("不支持该格式")},beforeUpload:function(e){var o=this.uploadBlob.size/1024<65;return o||this.$message.error("图片过大"),o},onClickUpload:function(){var e=this;this.$refs.perBaseInfoForm.validate(function(o){if(o)if(e.$refs.upload.uploadFiles.length<1){var s=e.$refs.perBaseInfoForm.model;e.$post("/person/update_info",{person_id:e.person.person_id,person_name:s.person_name,emp_number:s.emp_number}).then(function(o){e.$message.success(o.message),e.personList.find(function(o){return o.person_id===e.person.person_id}).person_name=e.personModel.person_name})}else e.$refs.upload.uploadFiles.length>1?e.$message.error("请选择图片"):e.$refs.upload.submit()})},onClickCropper:function(){var e=this.cropper.getCroppedCanvas({width:480,height:480,minWidth:240,minHeight:240,maxWidth:480,maxHeight:480,fillColor:"#000",imageSmoothingEnabled:!1,imageSmoothingQuality:"high"}),o=this.file.raw.size/1024,s=void 0;s=o>2048?.6:o>1024&&o<2048?.7:o>65&&o<1024?.75:.9;var t=e.toDataURL("image/jpeg",s);this.$refs.upload.uploadFiles[0]=this.file,this.uploadBlob=this.$utils.dataURLtoBlob(t),this.visible=!1,this.imageUrl=t},opened:function(){if(this.replace)this.cropper.replace(URL.createObjectURL(this.file.raw));else{var e=document.getElementsByClassName("cropper-container")[0].children[0];e.src=URL.createObjectURL(this.file.raw),this.cropper=new i.a(e,{aspectRatio:1,viewMode:0,preview:".cropper-preview"}),this.replace=!0}},closed:function(){this.visible=!1,this.file=""}},watch:{person:function(e,o){this.personModel=r()({},this.person),this.imageUrl="data:image/jpeg;base64,"+this.person.base_image}},computed:{personList:function(){return this.$store.getters["person/getPersonList"]}}}),p={render:function(){var e=this,o=e.$createElement,s=e._self._c||o;return s("div",[s("el-form",{ref:"perBaseInfoForm",attrs:{"label-width":"150px",rules:e.rules},model:{value:e.personModel,callback:function(o){e.personModel=o},expression:"personModel"}},[s("el-form-item",{attrs:{label:"人员ID"}},[s("span",[e._v(e._s(e.person.person_id))])]),e._v(" "),s("el-form-item",{attrs:{label:"注册时间"}},[s("span",[e._v(e._s(e._f("formatDate")(e.person.add_time)))])]),e._v(" "),s("el-form-item",{attrs:{label:"姓名",prop:"person_name"}},[s("el-input",{attrs:{value:e.person.person_name,type:"text",autocomplete:"off",size:"small"},model:{value:e.personModel.person_name,callback:function(o){e.$set(e.personModel,"person_name",o)},expression:"personModel.person_name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"工号"}},[s("el-input",{attrs:{value:e.person.emp_number,type:"text",autocomplete:"off",size:"small"},model:{value:e.personModel.emp_number,callback:function(o){e.$set(e.personModel,"emp_number",o)},expression:"personModel.emp_number"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"底库图片"}},[s("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:e.action,"show-file-list":!0,"http-request":e.myUpload,"auto-upload":!1,"on-change":e.onChange,"before-upload":e.beforeUpload}},[e.imageUrl?s("img",{staticClass:"image avatar",attrs:{src:e.imageUrl}}):e._e()])],1),e._v(" "),s("el-form-item",{attrs:{label:""}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){return e.onClickUpload()}}},[e._v("保存")]),e._v(" "),s("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(o){return e.deletePerson()}}},[e._v("删除")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"请将头像位于框中",visible:e.visible,width:"650px"},on:{"update:visible":function(o){e.visible=o},opened:e.opened,closed:e.closed}},[s("el-row",[s("el-col",{attrs:{span:16}},[s("div",{staticClass:"cropper-container"},[s("img")])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"cropper-preview"})])],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(o){e.visible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.onClickCropper}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var d=s("VU/8")(l,p,!1,function(e){s("ZLg6")},"data-v-1d18f43e",null);o.default=d.exports}});