webpackJsonp([18],{Sc5u:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("yyct"),r=a("4RJ8"),i=a.n(r),l=(a("5Qkr"),{name:"PersonAdd",inject:["reloadPerson"],data:function(){return{model:{person_name:"",emp_number:""},rules:{person_name:[{required:!0,message:"请输入姓名",trigger:"blur"}]},action:"/person/add",imageUrl:"",file:"",replace:!1,uploadBlob:"",visible:!1}},methods:{onChange:function(e,t){this.$refs.upload.clearFiles();var a=-1!==e.raw.type.indexOf("image"),o=e.raw.size/1024/1024<3;a?o?(this.file=e,this.visible=!0):this.$message.error("图片不能超过3M"):this.$message.error("不支持该格式")},beforeUpload:function(e){var t=this.uploadBlob.size/1024<65;return t||this.$message.error("图片过大"),t},onClickUpload:function(){var e=this;this.$refs.uploadForm.validate(function(t){if(t){if(e.$refs.upload.uploadFiles.length<=0)return void e.$message.error("请先选择图片");if(e.$refs.upload.uploadFiles.length>1)return void e.$message.error("图片数量过多");e.$refs.upload.submit()}})},myUpload:function(){var e=this,t=this.$refs.uploadForm.model,a=this.uploadBlob;o.a.showLoading("上传中");var r=new FormData;r.append("person_name",t.person_name),r.append("emp_number",t.emp_number),r.append("file",a),this.$axios.post("/person/add",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){var t=(e.loaded/e.total*100|0)+"%";console.log(t)}}).then(function(t){o.a.closeLoading(),o.a.alert(t.data.message),e.reloadPerson(),e.$router.push("/person/person_add")}).catch(function(e){o.a.closeLoading()})},onClickCropper:function(){var e=this.cropper.getCroppedCanvas({width:480,height:480,minWidth:240,minHeight:240,maxWidth:480,maxHeight:480,fillColor:"#000",imageSmoothingEnabled:!1,imageSmoothingQuality:"high"}),t=this.file.raw.size/1024,a=void 0;a=t>2048?.6:t>1024&&t<2048?.7:t>65&&t<1024?.75:.9;var o=e.toDataURL("image/jpeg",a);this.$refs.upload.uploadFiles[0]=this.file,this.uploadBlob=this.$utils.dataURLtoBlob(o),this.visible=!1,this.imageUrl=o},opened:function(){if(this.replace)this.cropper.replace(URL.createObjectURL(this.file.raw));else{var e=document.getElementsByClassName("cropper-container")[0].children[0];e.src=URL.createObjectURL(this.file.raw),this.cropper=new i.a(e,{aspectRatio:1,viewMode:0,preview:".cropper-preview"}),this.replace=!0}},closed:function(){this.visible=!1,this.file=""}}}),s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-breadcrumb",{staticStyle:{"margin-bottom":"15px"},attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("人员管理")]),e._v(" "),a("el-breadcrumb-item",[e._v("添加人员")])],1),e._v(" "),a("el-form",{ref:"uploadForm",attrs:{"label-width":"120px",model:e.model,rules:e.rules}},[a("el-form-item",{attrs:{label:"姓名",prop:"person_name"}},[a("el-input",{attrs:{type:"text",autocomplete:"off",placeholder:"请输入姓名",size:"small"},model:{value:e.model.person_name,callback:function(t){e.$set(e.model,"person_name",t)},expression:"model.person_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"工号",prop:"emp_number"}},[a("el-input",{attrs:{type:"text",autocomplete:"off",placeholder:"请输入工号",size:"small"},model:{value:e.model.emp_number,callback:function(t){e.$set(e.model,"emp_number",t)},expression:"model.emp_number"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"请选择图片"}},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:e.action,"show-file-list":!0,"http-request":e.myUpload,"auto-upload":!1,"on-change":e.onChange,"before-upload":e.beforeUpload}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.onClickUpload()}}},[e._v("添加")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"请将头像位于框中",visible:e.visible,width:"650px"},on:{"update:visible":function(t){e.visible=t},opened:e.opened,closed:e.closed}},[a("el-row",[a("el-col",{attrs:{span:16}},[a("div",{staticClass:"cropper-container"},[a("img")])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"cropper-preview"})])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onClickCropper}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(l,s,!1,function(e){a("fnkb")},"data-v-49aa2e09",null);t.default=n.exports},fnkb:function(e,t){}});